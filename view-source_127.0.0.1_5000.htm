
<!-- saved from url=(0022)http://127.0.0.1:5000/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="color-scheme" content="light dark"></head><body><div class="line-gutter-backdrop"></div><form autocomplete="off"><label class="line-wrap-control">Line wrap<input type="checkbox" aria-label="Line wrap"></label></form><table><tbody><tr><td class="line-number" value="1"></td><td class="line-content"><span class="html-doctype">&lt;!DOCTYPE html&gt;</span></td></tr><tr><td class="line-number" value="2"></td><td class="line-content"><span class="html-tag">&lt;html <span class="html-attribute-name">lang</span>="<span class="html-attribute-value">en</span>"&gt;</span></td></tr><tr><td class="line-number" value="3"></td><td class="line-content"><span class="html-tag">&lt;head&gt;</span></td></tr><tr><td class="line-number" value="4"></td><td class="line-content"><span class="html-tag">&lt;meta <span class="html-attribute-name">charset</span>="<span class="html-attribute-value">UTF-8</span>"&gt;</span></td></tr><tr><td class="line-number" value="5"></td><td class="line-content"><span class="html-tag">&lt;title&gt;</span>Network Analysis Dashboard<span class="html-tag">&lt;/title&gt;</span></td></tr><tr><td class="line-number" value="6"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="7"></td><td class="line-content"><span class="html-tag">&lt;link <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="noreferrer noopener">https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap</a>" <span class="html-attribute-name">rel</span>="<span class="html-attribute-value">stylesheet</span>"&gt;</span></td></tr><tr><td class="line-number" value="8"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="9"></td><td class="line-content"><span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://cdn.jsdelivr.net/npm/chart.js" rel="noreferrer noopener">https://cdn.jsdelivr.net/npm/chart.js</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="10"></td><td class="line-content"><span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2" rel="noreferrer noopener">https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="11"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="12"></td><td class="line-content"><span class="html-tag">&lt;link <span class="html-attribute-name">rel</span>="<span class="html-attribute-value">stylesheet</span>" <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="noreferrer noopener">https://unpkg.com/leaflet@1.9.4/dist/leaflet.css</a>"/&gt;</span></td></tr><tr><td class="line-number" value="13"></td><td class="line-content"><span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" rel="noreferrer noopener">https://unpkg.com/leaflet@1.9.4/dist/leaflet.js</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="14"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="15"></td><td class="line-content"><span class="html-tag">&lt;style&gt;</span></td></tr><tr><td class="line-number" value="16"></td><td class="line-content">:root {</td></tr><tr><td class="line-number" value="17"></td><td class="line-content">    --primary: #1e3a8a;</td></tr><tr><td class="line-number" value="18"></td><td class="line-content">    --secondary: #0ea5e9;</td></tr><tr><td class="line-number" value="19"></td><td class="line-content">    --success: #16a34a;</td></tr><tr><td class="line-number" value="20"></td><td class="line-content">    --warning: #f59e0b;</td></tr><tr><td class="line-number" value="21"></td><td class="line-content">    --danger: #dc2626;</td></tr><tr><td class="line-number" value="22"></td><td class="line-content">    --bg: #f4f6f9;</td></tr><tr><td class="line-number" value="23"></td><td class="line-content">    --card: #ffffff;</td></tr><tr><td class="line-number" value="24"></td><td class="line-content">    --text: #1f2937;</td></tr><tr><td class="line-number" value="25"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="26"></td><td class="line-content">* { box-sizing: border-box; }</td></tr><tr><td class="line-number" value="27"></td><td class="line-content">body {</td></tr><tr><td class="line-number" value="28"></td><td class="line-content">    margin: 0;</td></tr><tr><td class="line-number" value="29"></td><td class="line-content">    font-family: 'Inter', sans-serif;</td></tr><tr><td class="line-number" value="30"></td><td class="line-content">    background: var(--bg);</td></tr><tr><td class="line-number" value="31"></td><td class="line-content">    color: var(--text);</td></tr><tr><td class="line-number" value="32"></td><td class="line-content">    overflow-x: hidden;</td></tr><tr><td class="line-number" value="33"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="34"></td><td class="line-content">.dashboard { max-width: 1300px; margin: auto; padding: 24px; }</td></tr><tr><td class="line-number" value="35"></td><td class="line-content">.header { margin-bottom: 25px; }</td></tr><tr><td class="line-number" value="36"></td><td class="line-content">.header h1 { font-size: 26px; font-weight: 700; margin: 0; color: var(--primary); }</td></tr><tr><td class="line-number" value="37"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="38"></td><td class="line-content">.cards {</td></tr><tr><td class="line-number" value="39"></td><td class="line-content">    display: grid;</td></tr><tr><td class="line-number" value="40"></td><td class="line-content">    grid-template-columns: repeat(6, 1fr);</td></tr><tr><td class="line-number" value="41"></td><td class="line-content">    gap: 20px;</td></tr><tr><td class="line-number" value="42"></td><td class="line-content">    margin-bottom: 30px;</td></tr><tr><td class="line-number" value="43"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="44"></td><td class="line-content">.card {</td></tr><tr><td class="line-number" value="45"></td><td class="line-content">    background: var(--card);</td></tr><tr><td class="line-number" value="46"></td><td class="line-content">    border-radius: 14px;</td></tr><tr><td class="line-number" value="47"></td><td class="line-content">    padding: 22px;</td></tr><tr><td class="line-number" value="48"></td><td class="line-content">    box-shadow: 0 8px 20px rgba(0,0,0,0.04);</td></tr><tr><td class="line-number" value="49"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="50"></td><td class="line-content">.card h3 { font-size: 13px; font-weight: 600; color: #6b7280; margin: 0; }</td></tr><tr><td class="line-number" value="51"></td><td class="line-content">.card p {</td></tr><tr><td class="line-number" value="52"></td><td class="line-content">    font-size: 30px;</td></tr><tr><td class="line-number" value="53"></td><td class="line-content">    font-weight: 700;</td></tr><tr><td class="line-number" value="54"></td><td class="line-content">    margin-top: 8px;</td></tr><tr><td class="line-number" value="55"></td><td class="line-content">    color: var(--primary);</td></tr><tr><td class="line-number" value="56"></td><td class="line-content">    display: flex;</td></tr><tr><td class="line-number" value="57"></td><td class="line-content">    align-items: baseline;</td></tr><tr><td class="line-number" value="58"></td><td class="line-content">    gap: 10px;</td></tr><tr><td class="line-number" value="59"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="60"></td><td class="line-content">.card .pct {</td></tr><tr><td class="line-number" value="61"></td><td class="line-content">    font-size: 13px;</td></tr><tr><td class="line-number" value="62"></td><td class="line-content">    font-weight: 800;</td></tr><tr><td class="line-number" value="63"></td><td class="line-content">    padding: 4px 8px;</td></tr><tr><td class="line-number" value="64"></td><td class="line-content">    border-radius: 999px;</td></tr><tr><td class="line-number" value="65"></td><td class="line-content">    border: 1px solid transparent;</td></tr><tr><td class="line-number" value="66"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="67"></td><td class="line-content">.card .pct-inprogress { color:#065f46; background:#d1fae5; border-color:#a7f3d0; }</td></tr><tr><td class="line-number" value="68"></td><td class="line-content">.card .pct-resolved { color:#7f1d1d; background:#fee2e2; border-color:#fecaca; }</td></tr><tr><td class="line-number" value="69"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="70"></td><td class="line-content">.grid {</td></tr><tr><td class="line-number" value="71"></td><td class="line-content">    display: grid;</td></tr><tr><td class="line-number" value="72"></td><td class="line-content">    grid-template-columns: repeat(3, minmax(0,1fr));</td></tr><tr><td class="line-number" value="73"></td><td class="line-content">    gap: 20px;</td></tr><tr><td class="line-number" value="74"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="75"></td><td class="line-content">.chart-box {</td></tr><tr><td class="line-number" value="76"></td><td class="line-content">    position: relative;</td></tr><tr><td class="line-number" value="77"></td><td class="line-content">    background: var(--card);</td></tr><tr><td class="line-number" value="78"></td><td class="line-content">    border-radius: 14px;</td></tr><tr><td class="line-number" value="79"></td><td class="line-content">    padding: 16px;</td></tr><tr><td class="line-number" value="80"></td><td class="line-content">    box-shadow: 0 8px 20px rgba(0,0,0,0.04);</td></tr><tr><td class="line-number" value="81"></td><td class="line-content">    height: 300px;</td></tr><tr><td class="line-number" value="82"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="83"></td><td class="line-content">.chart-title { font-size: 13px; font-weight: 600; margin-bottom: 6px; color: #374151; }</td></tr><tr><td class="line-number" value="84"></td><td class="line-content">canvas { display: block; width: 100% !important; height: auto !important; }</td></tr><tr><td class="line-number" value="85"></td><td class="line-content">#map { width: 100%; height: 100%; border-radius: 12px; }</td></tr><tr><td class="line-number" value="86"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="87"></td><td class="line-content">.insight-btn {</td></tr><tr><td class="line-number" value="88"></td><td class="line-content">    position: absolute;</td></tr><tr><td class="line-number" value="89"></td><td class="line-content">    top: 12px;</td></tr><tr><td class="line-number" value="90"></td><td class="line-content">    right: 12px;</td></tr><tr><td class="line-number" value="91"></td><td class="line-content">    border: 1px solid #e5e7eb;</td></tr><tr><td class="line-number" value="92"></td><td class="line-content">    background: #fff;</td></tr><tr><td class="line-number" value="93"></td><td class="line-content">    color: #374151;</td></tr><tr><td class="line-number" value="94"></td><td class="line-content">    font-size: 12px;</td></tr><tr><td class="line-number" value="95"></td><td class="line-content">    font-weight: 600;</td></tr><tr><td class="line-number" value="96"></td><td class="line-content">    padding: 6px 10px;</td></tr><tr><td class="line-number" value="97"></td><td class="line-content">    border-radius: 999px;</td></tr><tr><td class="line-number" value="98"></td><td class="line-content">    cursor: pointer;</td></tr><tr><td class="line-number" value="99"></td><td class="line-content">    box-shadow: 0 6px 16px rgba(0,0,0,0.06);</td></tr><tr><td class="line-number" value="100"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="101"></td><td class="line-content">.insight-btn:hover { background: #f9fafb; }</td></tr><tr><td class="line-number" value="102"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="103"></td><td class="line-content">/* Modal (unchanged, kept minimal) */</td></tr><tr><td class="line-number" value="104"></td><td class="line-content">.modal-overlay {</td></tr><tr><td class="line-number" value="105"></td><td class="line-content">    position: fixed; inset: 0;</td></tr><tr><td class="line-number" value="106"></td><td class="line-content">    background: rgba(17,24,39,0.55);</td></tr><tr><td class="line-number" value="107"></td><td class="line-content">    display: none; align-items: center; justify-content: center;</td></tr><tr><td class="line-number" value="108"></td><td class="line-content">    padding: 20px; z-index: 9999;</td></tr><tr><td class="line-number" value="109"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="110"></td><td class="line-content">.modal { width: min(720px, 96vw); background:#fff; border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,0.25); overflow:hidden; }</td></tr><tr><td class="line-number" value="111"></td><td class="line-content">.modal-header { display:flex; justify-content:space-between; gap:12px; padding:16px 18px; border-bottom:1px solid #e5e7eb; }</td></tr><tr><td class="line-number" value="112"></td><td class="line-content">.modal-title { font-size:14px; font-weight:700; margin:0; color:#111827; }</td></tr><tr><td class="line-number" value="113"></td><td class="line-content">.modal-close { border:none; background:#f3f4f6; border-radius:10px; padding:8px 10px; cursor:pointer; font-weight:700; }</td></tr><tr><td class="line-number" value="114"></td><td class="line-content">.modal-body { padding:16px 18px 18px; font-size:13px; line-height:1.55; color:#111827; }</td></tr><tr><td class="line-number" value="115"></td><td class="line-content">.badge { display:inline-block; padding:2px 8px; border-radius:999px; font-size:11px; font-weight:700; background:#eef2ff; color:#1e3a8a; margin-left:8px; }</td></tr><tr><td class="line-number" value="116"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="117"></td><td class="line-content">/* Small formatting for insight body */</td></tr><tr><td class="line-number" value="118"></td><td class="line-content">.modal-body h4 { margin: 10px 0 6px; font-size: 13px; }</td></tr><tr><td class="line-number" value="119"></td><td class="line-content">.modal-body ul { margin: 6px 0 0 18px; padding: 0; }</td></tr><tr><td class="line-number" value="120"></td><td class="line-content">.modal-body li { margin: 4px 0; }</td></tr><tr><td class="line-number" value="121"></td><td class="line-content">.modal-body .muted { color:#6b7280; font-size:12px; }</td></tr><tr><td class="line-number" value="122"></td><td class="line-content"><span class="html-tag">&lt;/style&gt;</span></td></tr><tr><td class="line-number" value="123"></td><td class="line-content"><span class="html-tag">&lt;/head&gt;</span></td></tr><tr><td class="line-number" value="124"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="125"></td><td class="line-content"><span class="html-tag">&lt;body&gt;</span></td></tr><tr><td class="line-number" value="126"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">dashboard</span>"&gt;</span></td></tr><tr><td class="line-number" value="127"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="128"></td><td class="line-content">  <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">header</span>"&gt;</span></td></tr><tr><td class="line-number" value="129"></td><td class="line-content">      <span class="html-tag">&lt;h1&gt;</span>Network Analysis Dashboard<span class="html-tag">&lt;/h1&gt;</span></td></tr><tr><td class="line-number" value="130"></td><td class="line-content">  <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="131"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="132"></td><td class="line-content">  <span class="html-comment">&lt;!-- Cards order: State, District, Total Complaints, Total Submitted, In Progress, Resolved --&gt;</span></td></tr><tr><td class="line-number" value="133"></td><td class="line-content">  <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">cards</span>"&gt;</span></td></tr><tr><td class="line-number" value="134"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">card</span>"&gt;</span></td></tr><tr><td class="line-number" value="135"></td><td class="line-content">          <span class="html-tag">&lt;h3&gt;</span>Total States<span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="136"></td><td class="line-content">          <span class="html-tag">&lt;p <span class="html-attribute-name">id</span>="<span class="html-attribute-value">totalStates</span>"&gt;</span>-<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="137"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="138"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="139"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">card</span>"&gt;</span></td></tr><tr><td class="line-number" value="140"></td><td class="line-content">          <span class="html-tag">&lt;h3&gt;</span>Total Districts<span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="141"></td><td class="line-content">          <span class="html-tag">&lt;p <span class="html-attribute-name">id</span>="<span class="html-attribute-value">totalDistricts</span>"&gt;</span>-<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="142"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="143"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="144"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">card</span>"&gt;</span></td></tr><tr><td class="line-number" value="145"></td><td class="line-content">          <span class="html-tag">&lt;h3&gt;</span>Total Complaints<span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="146"></td><td class="line-content">          <span class="html-tag">&lt;p <span class="html-attribute-name">id</span>="<span class="html-attribute-value">totalComplaints</span>"&gt;</span>-<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="147"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="148"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="149"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">card</span>"&gt;</span></td></tr><tr><td class="line-number" value="150"></td><td class="line-content">          <span class="html-tag">&lt;h3&gt;</span>Total Submitted<span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="151"></td><td class="line-content">          <span class="html-tag">&lt;p <span class="html-attribute-name">id</span>="<span class="html-attribute-value">totalSubmitted</span>"&gt;</span>-<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="152"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="153"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="154"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">card</span>"&gt;</span></td></tr><tr><td class="line-number" value="155"></td><td class="line-content">          <span class="html-tag">&lt;h3&gt;</span>Total In Progress<span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="156"></td><td class="line-content">          <span class="html-tag">&lt;p&gt;</span><span class="html-tag">&lt;span <span class="html-attribute-name">id</span>="<span class="html-attribute-value">totalInProgress</span>"&gt;</span>-<span class="html-tag">&lt;/span&gt;</span><span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">pct pct-inprogress</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">pctInProgress</span>"&gt;</span>-<span class="html-tag">&lt;/span&gt;</span><span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="157"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="158"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="159"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">card</span>"&gt;</span></td></tr><tr><td class="line-number" value="160"></td><td class="line-content">          <span class="html-tag">&lt;h3&gt;</span>Total Resolved<span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="161"></td><td class="line-content">          <span class="html-tag">&lt;p&gt;</span><span class="html-tag">&lt;span <span class="html-attribute-name">id</span>="<span class="html-attribute-value">totalResolved</span>"&gt;</span>-<span class="html-tag">&lt;/span&gt;</span><span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">pct pct-resolved</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">pctResolved</span>"&gt;</span>-<span class="html-tag">&lt;/span&gt;</span><span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="162"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="163"></td><td class="line-content">  <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="164"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="165"></td><td class="line-content">  <span class="html-comment">&lt;!-- Chart order per request --&gt;</span></td></tr><tr><td class="line-number" value="166"></td><td class="line-content">  <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">grid</span>"&gt;</span></td></tr><tr><td class="line-number" value="167"></td><td class="line-content">      <span class="html-comment">&lt;!-- Row 1 --&gt;</span></td></tr><tr><td class="line-number" value="168"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chart-box</span>"&gt;</span></td></tr><tr><td class="line-number" value="169"></td><td class="line-content">          <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">insight-btn</span>" <span class="html-attribute-name">data-insight</span>="<span class="html-attribute-value">state</span>"&gt;</span>Insight<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="170"></td><td class="line-content">          <span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">stateChart</span>"&gt;</span><span class="html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="line-number" value="171"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="172"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="173"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chart-box</span>"&gt;</span></td></tr><tr><td class="line-number" value="174"></td><td class="line-content">          <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">insight-btn</span>" <span class="html-attribute-name">data-insight</span>="<span class="html-attribute-value">district</span>"&gt;</span>Insight<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="175"></td><td class="line-content">          <span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">districtChart</span>"&gt;</span><span class="html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="line-number" value="176"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="177"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="178"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chart-box</span>"&gt;</span></td></tr><tr><td class="line-number" value="179"></td><td class="line-content">          <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">insight-btn</span>" <span class="html-attribute-name">data-insight</span>="<span class="html-attribute-value">issue_type</span>"&gt;</span>Insight<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="180"></td><td class="line-content">          <span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">issueChart</span>"&gt;</span><span class="html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="line-number" value="181"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="182"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="183"></td><td class="line-content">      <span class="html-comment">&lt;!-- Row 2 --&gt;</span></td></tr><tr><td class="line-number" value="184"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chart-box</span>"&gt;</span></td></tr><tr><td class="line-number" value="185"></td><td class="line-content">          <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">insight-btn</span>" <span class="html-attribute-name">data-insight</span>="<span class="html-attribute-value">signal_strength_by_state</span>"&gt;</span>Insight<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="186"></td><td class="line-content">          <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chart-title</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">signalByStateTitle</span>"&gt;</span>Signal Strength by State<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="187"></td><td class="line-content">          <span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">coverageChart</span>"&gt;</span><span class="html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="line-number" value="188"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="189"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="190"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chart-box</span>"&gt;</span></td></tr><tr><td class="line-number" value="191"></td><td class="line-content">          <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">insight-btn</span>" <span class="html-attribute-name">data-insight</span>="<span class="html-attribute-value">issue_by_state</span>"&gt;</span>Insight<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="192"></td><td class="line-content">          <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chart-title</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">issueByStateTitle</span>"&gt;</span>Issue Type by State<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="193"></td><td class="line-content">          <span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">issueByStateChart</span>"&gt;</span><span class="html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="line-number" value="194"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="195"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="196"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chart-box</span>"&gt;</span></td></tr><tr><td class="line-number" value="197"></td><td class="line-content">          <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">insight-btn</span>" <span class="html-attribute-name">data-insight</span>="<span class="html-attribute-value">status_by_state</span>"&gt;</span>Insight<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="198"></td><td class="line-content">          <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chart-title</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">statusByStateTitle</span>"&gt;</span>Status Report by State<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="199"></td><td class="line-content">          <span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">statusByStateChart</span>"&gt;</span><span class="html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="line-number" value="200"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="201"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="202"></td><td class="line-content">      <span class="html-comment">&lt;!-- Row 3 --&gt;</span></td></tr><tr><td class="line-number" value="203"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chart-box</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">grid-column: span 3; height: 320px;</span>"&gt;</span></td></tr><tr><td class="line-number" value="204"></td><td class="line-content">          <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">insight-btn</span>" <span class="html-attribute-name">data-insight</span>="<span class="html-attribute-value">reported_months</span>"&gt;</span>Insight<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="205"></td><td class="line-content">          <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chart-title</span>"&gt;</span>Complaints Reported<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="206"></td><td class="line-content">          <span class="html-tag">&lt;canvas <span class="html-attribute-name">id</span>="<span class="html-attribute-value">reportedMonthsChart</span>"&gt;</span><span class="html-tag">&lt;/canvas&gt;</span></td></tr><tr><td class="line-number" value="207"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="208"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="209"></td><td class="line-content">      <span class="html-comment">&lt;!-- Map --&gt;</span></td></tr><tr><td class="line-number" value="210"></td><td class="line-content">      <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chart-box</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">grid-column: span 3; height: 420px;</span>"&gt;</span></td></tr><tr><td class="line-number" value="211"></td><td class="line-content">          <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chart-title</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">mapTitle</span>"&gt;</span>Heatmap: Total Complaints by District<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="212"></td><td class="line-content">          <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">map</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="213"></td><td class="line-content">      <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="214"></td><td class="line-content">  <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="215"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="216"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="217"></td><td class="line-content"><span class="html-comment">&lt;!-- Modal --&gt;</span></td></tr><tr><td class="line-number" value="218"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">modal-overlay</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">insightOverlay</span>" <span class="html-attribute-name">role</span>="<span class="html-attribute-value">dialog</span>" <span class="html-attribute-name">aria-modal</span>="<span class="html-attribute-value">true</span>" <span class="html-attribute-name">aria-hidden</span>="<span class="html-attribute-value">true</span>"&gt;</span></td></tr><tr><td class="line-number" value="219"></td><td class="line-content">  <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">modal</span>"&gt;</span></td></tr><tr><td class="line-number" value="220"></td><td class="line-content">    <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">modal-header</span>"&gt;</span></td></tr><tr><td class="line-number" value="221"></td><td class="line-content">      <span class="html-tag">&lt;div&gt;</span><span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">modal-title</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">insightTitle</span>"&gt;</span>Insight<span class="html-tag">&lt;/p&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="222"></td><td class="line-content">      <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">modal-close</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">insightClose</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">button</span>"&gt;</span>Close<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="223"></td><td class="line-content">    <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="224"></td><td class="line-content">    <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">modal-body</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">insightBody</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="225"></td><td class="line-content">  <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="226"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="227"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="228"></td><td class="line-content"><span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="229"></td><td class="line-content">Chart.register(ChartDataLabels);</td></tr><tr><td class="line-number" value="230"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="231"></td><td class="line-content">/* ---------- helpers ---------- */</td></tr><tr><td class="line-number" value="232"></td><td class="line-content">function fmtInt(n){ return (Number(n)||0).toLocaleString(); }</td></tr><tr><td class="line-number" value="233"></td><td class="line-content">function pct(part,total){ part=Number(part)||0; total=Number(total)||0; if(!total) return 0; return (part/total)*100; }</td></tr><tr><td class="line-number" value="234"></td><td class="line-content">function fmtPct(x){ return `${(Number(x)||0).toFixed(2)}%`; }</td></tr><tr><td class="line-number" value="235"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="236"></td><td class="line-content">/* ---------- base chart options ---------- */</td></tr><tr><td class="line-number" value="237"></td><td class="line-content">const barOptions = {</td></tr><tr><td class="line-number" value="238"></td><td class="line-content">  responsive: true,</td></tr><tr><td class="line-number" value="239"></td><td class="line-content">  maintainAspectRatio: false,</td></tr><tr><td class="line-number" value="240"></td><td class="line-content">  plugins: {</td></tr><tr><td class="line-number" value="241"></td><td class="line-content">    legend: { display: true, position: "top" },</td></tr><tr><td class="line-number" value="242"></td><td class="line-content">    datalabels: { color:"#374151", anchor:"end", align:"end", font:{ size:10 } }</td></tr><tr><td class="line-number" value="243"></td><td class="line-content">  },</td></tr><tr><td class="line-number" value="244"></td><td class="line-content">  scales: {</td></tr><tr><td class="line-number" value="245"></td><td class="line-content">    x: { ticks: { font:{ size:10 }, maxRotation:45, minRotation:30 } },</td></tr><tr><td class="line-number" value="246"></td><td class="line-content">    y: { ticks: { font:{ size:10 } } }</td></tr><tr><td class="line-number" value="247"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="248"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="249"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="250"></td><td class="line-content">/* =========================================================</td></tr><tr><td class="line-number" value="251"></td><td class="line-content">   MAP (District Heatmap)</td></tr><tr><td class="line-number" value="252"></td><td class="line-content">========================================================= */</td></tr><tr><td class="line-number" value="253"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="254"></td><td class="line-content">/* Normalize district name for matching (dataset vs geojson) */</td></tr><tr><td class="line-number" value="255"></td><td class="line-content">function normalizeDistrictName(name){</td></tr><tr><td class="line-number" value="256"></td><td class="line-content">  return (name || "")</td></tr><tr><td class="line-number" value="257"></td><td class="line-content">    .toString()</td></tr><tr><td class="line-number" value="258"></td><td class="line-content">    .toLowerCase()</td></tr><tr><td class="line-number" value="259"></td><td class="line-content">    .replace(/\bdistrict\b/g, "")</td></tr><tr><td class="line-number" value="260"></td><td class="line-content">    .replace(/\bdaerah\b/g, "")</td></tr><tr><td class="line-number" value="261"></td><td class="line-content">    .replace(/&amp;/g, "and")</td></tr><tr><td class="line-number" value="262"></td><td class="line-content">    .replace(/[^\p{L}\p{N}\s-]/gu, "")  // remove punctuation (unicode safe)</td></tr><tr><td class="line-number" value="263"></td><td class="line-content">    .replace(/\s+/g, " ")</td></tr><tr><td class="line-number" value="264"></td><td class="line-content">    .trim();</td></tr><tr><td class="line-number" value="265"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="266"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="267"></td><td class="line-content">/* GeoBoundaries ADM2 uses `shapeName` (most common). Keep fallbacks. */</td></tr><tr><td class="line-number" value="268"></td><td class="line-content">function getGeoDistrictName(p){</td></tr><tr><td class="line-number" value="269"></td><td class="line-content">  return p.shapeName || p.ADM2_NAME || p.NAME_2 || p.district || p.name || "";</td></tr><tr><td class="line-number" value="270"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="271"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="272"></td><td class="line-content">/* Color thresholds (same palette as before) */</td></tr><tr><td class="line-number" value="273"></td><td class="line-content">// Color thresholds (fixed for district counts)</td></tr><tr><td class="line-number" value="274"></td><td class="line-content">function getHeatColor(v){</td></tr><tr><td class="line-number" value="275"></td><td class="line-content">  v = Number(v) || 0;</td></tr><tr><td class="line-number" value="276"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="277"></td><td class="line-content">  // grey = 0-36</td></tr><tr><td class="line-number" value="278"></td><td class="line-content">  if (v &lt;= 36) return "#9ca3af";</td></tr><tr><td class="line-number" value="279"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="280"></td><td class="line-content">  // hijau = 37-56</td></tr><tr><td class="line-number" value="281"></td><td class="line-content">  if (v &lt;= 56) return "#22c55e";</td></tr><tr><td class="line-number" value="282"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="283"></td><td class="line-content">  // kuning = 57-63</td></tr><tr><td class="line-number" value="284"></td><td class="line-content">  if (v &lt;= 63) return "#facc15";</td></tr><tr><td class="line-number" value="285"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="286"></td><td class="line-content">  // merah = 64-85 (and above)</td></tr><tr><td class="line-number" value="287"></td><td class="line-content">  return "#dc2626";</td></tr><tr><td class="line-number" value="288"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="289"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="290"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="291"></td><td class="line-content">/* District map init */</td></tr><tr><td class="line-number" value="292"></td><td class="line-content">function initDistrictMap(districtData){</td></tr><tr><td class="line-number" value="293"></td><td class="line-content">  // Create map once</td></tr><tr><td class="line-number" value="294"></td><td class="line-content">  const map = L.map("map").setView([4.2, 102.3], 6);</td></tr><tr><td class="line-number" value="295"></td><td class="line-content">  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { attribution: "&amp;copy; OpenStreetMap" }).addTo(map);</td></tr><tr><td class="line-number" value="296"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="297"></td><td class="line-content">  // Build lookup: normalized district -&gt; value</td></tr><tr><td class="line-number" value="298"></td><td class="line-content">  const lookup = {};</td></tr><tr><td class="line-number" value="299"></td><td class="line-content">  for (const key in districtData){</td></tr><tr><td class="line-number" value="300"></td><td class="line-content">    lookup[normalizeDistrictName(key)] = Number(districtData[key]) || 0;</td></tr><tr><td class="line-number" value="301"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="302"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="303"></td><td class="line-content">  fetch("/static/malaysia.district.geojson")</td></tr><tr><td class="line-number" value="304"></td><td class="line-content">    .then(r=&gt;r.json())</td></tr><tr><td class="line-number" value="305"></td><td class="line-content">    .then(geo=&gt;{</td></tr><tr><td class="line-number" value="306"></td><td class="line-content">      L.geoJSON(geo,{</td></tr><tr><td class="line-number" value="307"></td><td class="line-content">        style: feature =&gt; {</td></tr><tr><td class="line-number" value="308"></td><td class="line-content">          const rawName = getGeoDistrictName(feature.properties || {});</td></tr><tr><td class="line-number" value="309"></td><td class="line-content">          const k = normalizeDistrictName(rawName);</td></tr><tr><td class="line-number" value="310"></td><td class="line-content">          const value = lookup[k] ?? 0;</td></tr><tr><td class="line-number" value="311"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="312"></td><td class="line-content">          return {</td></tr><tr><td class="line-number" value="313"></td><td class="line-content">            fillColor: getHeatColor(value),</td></tr><tr><td class="line-number" value="314"></td><td class="line-content">            weight: 0.8,</td></tr><tr><td class="line-number" value="315"></td><td class="line-content">            color: "#374151",</td></tr><tr><td class="line-number" value="316"></td><td class="line-content">            fillOpacity: 0.70</td></tr><tr><td class="line-number" value="317"></td><td class="line-content">          };</td></tr><tr><td class="line-number" value="318"></td><td class="line-content">        },</td></tr><tr><td class="line-number" value="319"></td><td class="line-content">        onEachFeature: (feature, layer) =&gt; {</td></tr><tr><td class="line-number" value="320"></td><td class="line-content">  const rawName = getGeoDistrictName(feature.properties || {});</td></tr><tr><td class="line-number" value="321"></td><td class="line-content">  const k = normalizeDistrictName(rawName);</td></tr><tr><td class="line-number" value="322"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="323"></td><td class="line-content">  const hasData = Object.prototype.hasOwnProperty.call(lookup, k);</td></tr><tr><td class="line-number" value="324"></td><td class="line-content">  const value = hasData ? (lookup[k] ?? 0) : null;</td></tr><tr><td class="line-number" value="325"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="326"></td><td class="line-content">  layer.bindTooltip(</td></tr><tr><td class="line-number" value="327"></td><td class="line-content">    hasData</td></tr><tr><td class="line-number" value="328"></td><td class="line-content">      ? `&lt;b&gt;${rawName}&lt;/b&gt;&lt;br&gt;Total Complaints: ${value}`</td></tr><tr><td class="line-number" value="329"></td><td class="line-content">      : `&lt;b&gt;${rawName}&lt;/b&gt;&lt;br&gt;&lt;span style="color:#6b7280"&gt;0&lt;/span&gt;`,</td></tr><tr><td class="line-number" value="330"></td><td class="line-content">    { sticky:true }</td></tr><tr><td class="line-number" value="331"></td><td class="line-content">  );</td></tr><tr><td class="line-number" value="332"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="333"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="334"></td><td class="line-content">      }).addTo(map);</td></tr><tr><td class="line-number" value="335"></td><td class="line-content">    })</td></tr><tr><td class="line-number" value="336"></td><td class="line-content">    .catch(err=&gt;{</td></tr><tr><td class="line-number" value="337"></td><td class="line-content">      console.error("Failed to load district geojson:", err);</td></tr><tr><td class="line-number" value="338"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="339"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="340"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="341"></td><td class="line-content">/* ---------- modal wiring (keep) ---------- */</td></tr><tr><td class="line-number" value="342"></td><td class="line-content">const overlay = document.getElementById("insightOverlay");</td></tr><tr><td class="line-number" value="343"></td><td class="line-content">const closeBtn = document.getElementById("insightClose");</td></tr><tr><td class="line-number" value="344"></td><td class="line-content">closeBtn.addEventListener("click", ()=&gt;{ overlay.style.display="none"; overlay.setAttribute("aria-hidden","true"); });</td></tr><tr><td class="line-number" value="345"></td><td class="line-content">overlay.addEventListener("click", (e)=&gt;{ if(e.target===overlay){ overlay.style.display="none"; overlay.setAttribute("aria-hidden","true"); } });</td></tr><tr><td class="line-number" value="346"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="347"></td><td class="line-content">/* =========================================================</td></tr><tr><td class="line-number" value="348"></td><td class="line-content">   INSIGHT CONTENT (ENGLISH) - static text (no app.py change)</td></tr><tr><td class="line-number" value="349"></td><td class="line-content">========================================================= */</td></tr><tr><td class="line-number" value="350"></td><td class="line-content">const INSIGHTS = {</td></tr><tr><td class="line-number" value="351"></td><td class="line-content">  state: {</td></tr><tr><td class="line-number" value="352"></td><td class="line-content">    title: "Total Complaints by State",</td></tr><tr><td class="line-number" value="353"></td><td class="line-content">    body: `</td></tr><tr><td class="line-number" value="354"></td><td class="line-content">      &lt;h4&gt;Interpretation&lt;/h4&gt;</td></tr><tr><td class="line-number" value="355"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="356"></td><td class="line-content">        &lt;li&gt;Complaints are distributed across states with a clear top state, but no extreme outlier.&lt;/li&gt;</td></tr><tr><td class="line-number" value="357"></td><td class="line-content">        &lt;li&gt;This suggests issues are broad-based, with certain states requiring priority attention.&lt;/li&gt;</td></tr><tr><td class="line-number" value="358"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="359"></td><td class="line-content">      &lt;h4&gt;Suggestions&lt;/h4&gt;</td></tr><tr><td class="line-number" value="360"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="361"></td><td class="line-content">        &lt;li&gt;Prioritize the top 13 states for deeper drilldown by &lt;b&gt;district&lt;/b&gt; and &lt;b&gt;issue type&lt;/b&gt;.&lt;/li&gt;</td></tr><tr><td class="line-number" value="362"></td><td class="line-content">        &lt;li&gt;Allocate field resources and monitoring focus based on the state ranking.&lt;/li&gt;</td></tr><tr><td class="line-number" value="363"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="364"></td><td class="line-content">    `</td></tr><tr><td class="line-number" value="365"></td><td class="line-content">  },</td></tr><tr><td class="line-number" value="366"></td><td class="line-content">  district: {</td></tr><tr><td class="line-number" value="367"></td><td class="line-content">    title: "Total Complaints by District",</td></tr><tr><td class="line-number" value="368"></td><td class="line-content">    body: `</td></tr><tr><td class="line-number" value="369"></td><td class="line-content">      &lt;h4&gt;Interpretation&lt;/h4&gt;</td></tr><tr><td class="line-number" value="370"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="371"></td><td class="line-content">        &lt;li&gt;District-level distribution is more localized, where a few districts can contribute disproportionately.&lt;/li&gt;</td></tr><tr><td class="line-number" value="372"></td><td class="line-content">        &lt;li&gt;This often indicates site-level problems or localized coverage gaps.&lt;/li&gt;</td></tr><tr><td class="line-number" value="373"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="374"></td><td class="line-content">      &lt;h4&gt;Suggestions&lt;/h4&gt;</td></tr><tr><td class="line-number" value="375"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="376"></td><td class="line-content">        &lt;li&gt;Create a Top 5 district action list: site checks, drive tests, rapid ticket triage.&lt;/li&gt;</td></tr><tr><td class="line-number" value="377"></td><td class="line-content">        &lt;li&gt;If available, normalize by subscribers/population to remove density bias.&lt;/li&gt;</td></tr><tr><td class="line-number" value="378"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="379"></td><td class="line-content">    `</td></tr><tr><td class="line-number" value="380"></td><td class="line-content">  },</td></tr><tr><td class="line-number" value="381"></td><td class="line-content">  issue_type: {</td></tr><tr><td class="line-number" value="382"></td><td class="line-content">    title: "Total Complaints by Issue Type",</td></tr><tr><td class="line-number" value="383"></td><td class="line-content">    body: `</td></tr><tr><td class="line-number" value="384"></td><td class="line-content">      &lt;h4&gt;Interpretation&lt;/h4&gt;</td></tr><tr><td class="line-number" value="385"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="386"></td><td class="line-content">        &lt;li&gt;Leading issue types such as &lt;b&gt;Service Outage&lt;/b&gt; / &lt;b&gt;No Signal&lt;/b&gt; indicate availability and coverage continuity are the main drivers.&lt;/li&gt;</td></tr><tr><td class="line-number" value="387"></td><td class="line-content">        &lt;li&gt;Lower Slow Speed suggests performance tuning is secondary to restoring stable access.&lt;/li&gt;</td></tr><tr><td class="line-number" value="388"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="389"></td><td class="line-content">      &lt;h4&gt;Suggestions&lt;/h4&gt;</td></tr><tr><td class="line-number" value="390"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="391"></td><td class="line-content">        &lt;li&gt;Use triage order: &lt;b&gt;Outage/No Signal  Call Drop  Poor Coverage  Slow Speed&lt;/b&gt;.&lt;/li&gt;</td></tr><tr><td class="line-number" value="392"></td><td class="line-content">        &lt;li&gt;Track MTTR for Outage/No Signal as a primary operational KPI.&lt;/li&gt;</td></tr><tr><td class="line-number" value="393"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="394"></td><td class="line-content">    `</td></tr><tr><td class="line-number" value="395"></td><td class="line-content">  },</td></tr><tr><td class="line-number" value="396"></td><td class="line-content">  signal_strength_by_state: {</td></tr><tr><td class="line-number" value="397"></td><td class="line-content">    title: "Signal Strength by State",</td></tr><tr><td class="line-number" value="398"></td><td class="line-content">    body: `</td></tr><tr><td class="line-number" value="399"></td><td class="line-content">      &lt;h4&gt;Interpretation&lt;/h4&gt;</td></tr><tr><td class="line-number" value="400"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="401"></td><td class="line-content">        &lt;li&gt;States show mixed signal distributions, indicating inconsistent user experience within each state.&lt;/li&gt;</td></tr><tr><td class="line-number" value="402"></td><td class="line-content">        &lt;li&gt;Large weak/no-signal segments typically align with No Signal and Poor Coverage complaint patterns.&lt;/li&gt;</td></tr><tr><td class="line-number" value="403"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="404"></td><td class="line-content">      &lt;h4&gt;Suggestions&lt;/h4&gt;</td></tr><tr><td class="line-number" value="405"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="406"></td><td class="line-content">        &lt;li&gt;Prioritize states with the highest &lt;b&gt;Weak + No Signal&lt;/b&gt; share for RF optimization.&lt;/li&gt;</td></tr><tr><td class="line-number" value="407"></td><td class="line-content">        &lt;li&gt;Use this to justify coverage expansion (tilt optimization, new sites, indoor solutions).&lt;/li&gt;</td></tr><tr><td class="line-number" value="408"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="409"></td><td class="line-content">    `</td></tr><tr><td class="line-number" value="410"></td><td class="line-content">  },</td></tr><tr><td class="line-number" value="411"></td><td class="line-content">  issue_by_state: {</td></tr><tr><td class="line-number" value="412"></td><td class="line-content">    title: "Issue Type by State",</td></tr><tr><td class="line-number" value="413"></td><td class="line-content">    body: `</td></tr><tr><td class="line-number" value="414"></td><td class="line-content">      &lt;h4&gt;Interpretation&lt;/h4&gt;</td></tr><tr><td class="line-number" value="415"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="416"></td><td class="line-content">        &lt;li&gt;This chart explains &lt;b&gt;why&lt;/b&gt; each state has complaints by showing the dominant issue types per state.&lt;/li&gt;</td></tr><tr><td class="line-number" value="417"></td><td class="line-content">        &lt;li&gt;Outage-heavy states require different actions than coverage-heavy or drop-heavy states.&lt;/li&gt;</td></tr><tr><td class="line-number" value="418"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="419"></td><td class="line-content">      &lt;h4&gt;Suggestions&lt;/h4&gt;</td></tr><tr><td class="line-number" value="420"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="421"></td><td class="line-content">        &lt;li&gt;Identify the &lt;b&gt;Top 1 issue type&lt;/b&gt; per state and treat it as the primary fix path.&lt;/li&gt;</td></tr><tr><td class="line-number" value="422"></td><td class="line-content">        &lt;li&gt;Use a playbook approach: Outage-heavy (reliability), Coverage-heavy (RF expansion), Drop-heavy (handover/interference).&lt;/li&gt;</td></tr><tr><td class="line-number" value="423"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="424"></td><td class="line-content">    `</td></tr><tr><td class="line-number" value="425"></td><td class="line-content">  },</td></tr><tr><td class="line-number" value="426"></td><td class="line-content">  status_by_state: {</td></tr><tr><td class="line-number" value="427"></td><td class="line-content">    title: "Status Report by State",</td></tr><tr><td class="line-number" value="428"></td><td class="line-content">    body: `</td></tr><tr><td class="line-number" value="429"></td><td class="line-content">      &lt;h4&gt;Interpretation&lt;/h4&gt;</td></tr><tr><td class="line-number" value="430"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="431"></td><td class="line-content">        &lt;li&gt;States where &lt;b&gt;In Progress&lt;/b&gt; is close to or higher than &lt;b&gt;Resolved&lt;/b&gt; indicate backlog risk.&lt;/li&gt;</td></tr><tr><td class="line-number" value="432"></td><td class="line-content">        &lt;li&gt;Differences by state suggest uneven closure capacity or case complexity.&lt;/li&gt;</td></tr><tr><td class="line-number" value="433"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="434"></td><td class="line-content">      &lt;h4&gt;Suggestions&lt;/h4&gt;</td></tr><tr><td class="line-number" value="435"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="436"></td><td class="line-content">        &lt;li&gt;Add backlog indicators per state (In Progress / Total, Resolved rate).&lt;/li&gt;</td></tr><tr><td class="line-number" value="437"></td><td class="line-content">        &lt;li&gt;For high-backlog states: add manpower, enforce aging SLAs, and escalate Outage/No Signal first.&lt;/li&gt;</td></tr><tr><td class="line-number" value="438"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="439"></td><td class="line-content">    `</td></tr><tr><td class="line-number" value="440"></td><td class="line-content">  },</td></tr><tr><td class="line-number" value="441"></td><td class="line-content">  reported_months: {</td></tr><tr><td class="line-number" value="442"></td><td class="line-content">    title: "Complaints Reported (Monthly Trend)",</td></tr><tr><td class="line-number" value="443"></td><td class="line-content">    body: `</td></tr><tr><td class="line-number" value="444"></td><td class="line-content">      &lt;h4&gt;Interpretation&lt;/h4&gt;</td></tr><tr><td class="line-number" value="445"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="446"></td><td class="line-content">        &lt;li&gt;A sudden spike and sustained elevated level typically indicates a major incident period or a reporting/data scope change.&lt;/li&gt;</td></tr><tr><td class="line-number" value="447"></td><td class="line-content">        &lt;li&gt;Elevated post-peak levels may suggest incomplete recovery or continued reporting volume.&lt;/li&gt;</td></tr><tr><td class="line-number" value="448"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="449"></td><td class="line-content">      &lt;h4&gt;Suggestions&lt;/h4&gt;</td></tr><tr><td class="line-number" value="450"></td><td class="line-content">      &lt;ul&gt;</td></tr><tr><td class="line-number" value="451"></td><td class="line-content">        &lt;li&gt;Investigate what changed at the spike start point (rollout, outages, reporting changes, ingestion changes).&lt;/li&gt;</td></tr><tr><td class="line-number" value="452"></td><td class="line-content">        &lt;li&gt;Drill down spike months by &lt;b&gt;state&lt;/b&gt; and &lt;b&gt;issue type&lt;/b&gt; to identify main contributors.&lt;/li&gt;</td></tr><tr><td class="line-number" value="453"></td><td class="line-content">      &lt;/ul&gt;</td></tr><tr><td class="line-number" value="454"></td><td class="line-content">    `</td></tr><tr><td class="line-number" value="455"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="456"></td><td class="line-content">};</td></tr><tr><td class="line-number" value="457"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="458"></td><td class="line-content">function showInsight(key){</td></tr><tr><td class="line-number" value="459"></td><td class="line-content">  const cfg = INSIGHTS[key];</td></tr><tr><td class="line-number" value="460"></td><td class="line-content">  const titleEl = document.getElementById("insightTitle");</td></tr><tr><td class="line-number" value="461"></td><td class="line-content">  const bodyEl  = document.getElementById("insightBody");</td></tr><tr><td class="line-number" value="462"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="463"></td><td class="line-content">  if(!cfg){</td></tr><tr><td class="line-number" value="464"></td><td class="line-content">    titleEl.textContent = "Insight";</td></tr><tr><td class="line-number" value="465"></td><td class="line-content">    bodyEl.innerHTML = `&lt;div class="muted"&gt;No insight content configured for key: &lt;b&gt;${key}&lt;/b&gt;.&lt;/div&gt;`;</td></tr><tr><td class="line-number" value="466"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="467"></td><td class="line-content">    titleEl.textContent = cfg.title || "Insight";</td></tr><tr><td class="line-number" value="468"></td><td class="line-content">    bodyEl.innerHTML = cfg.body || "";</td></tr><tr><td class="line-number" value="469"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="470"></td><td class="line-content">  overlay.style.display = "flex";</td></tr><tr><td class="line-number" value="471"></td><td class="line-content">  overlay.setAttribute("aria-hidden","false");</td></tr><tr><td class="line-number" value="472"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="473"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="474"></td><td class="line-content">document.querySelectorAll(".insight-btn").forEach(btn=&gt;{</td></tr><tr><td class="line-number" value="475"></td><td class="line-content">  btn.addEventListener("click", ()=&gt;{</td></tr><tr><td class="line-number" value="476"></td><td class="line-content">    const key = btn.getAttribute("data-insight");</td></tr><tr><td class="line-number" value="477"></td><td class="line-content">    showInsight(key);</td></tr><tr><td class="line-number" value="478"></td><td class="line-content">  });</td></tr><tr><td class="line-number" value="479"></td><td class="line-content">});</td></tr><tr><td class="line-number" value="480"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="481"></td><td class="line-content">/* ---------- main loader ---------- */</td></tr><tr><td class="line-number" value="482"></td><td class="line-content">async function loadDashboard(){</td></tr><tr><td class="line-number" value="483"></td><td class="line-content">  // 1) summary</td></tr><tr><td class="line-number" value="484"></td><td class="line-content">  const summary = await fetch("/api/summary").then(r=&gt;r.json());</td></tr><tr><td class="line-number" value="485"></td><td class="line-content">  const totalComplaints = Number(summary.total_complaints||0);</td></tr><tr><td class="line-number" value="486"></td><td class="line-content">  const totalSubmitted  = Number(summary.total_submitted||0);</td></tr><tr><td class="line-number" value="487"></td><td class="line-content">  const totalInProgress = Number(summary.total_in_progress||0);</td></tr><tr><td class="line-number" value="488"></td><td class="line-content">  const totalResolved   = Number(summary.total_resolved||0);</td></tr><tr><td class="line-number" value="489"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="490"></td><td class="line-content">  document.getElementById("totalStates").innerText = fmtInt(summary.total_states);</td></tr><tr><td class="line-number" value="491"></td><td class="line-content">  document.getElementById("totalDistricts").innerText = fmtInt(summary.total_districts);</td></tr><tr><td class="line-number" value="492"></td><td class="line-content">  document.getElementById("totalComplaints").innerText = fmtInt(totalComplaints);</td></tr><tr><td class="line-number" value="493"></td><td class="line-content">  document.getElementById("totalSubmitted").innerText = fmtInt(totalSubmitted);</td></tr><tr><td class="line-number" value="494"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="495"></td><td class="line-content">  document.getElementById("totalInProgress").innerText = fmtInt(totalInProgress);</td></tr><tr><td class="line-number" value="496"></td><td class="line-content">  document.getElementById("pctInProgress").innerText = `(${fmtPct(pct(totalInProgress, totalSubmitted))})`;</td></tr><tr><td class="line-number" value="497"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="498"></td><td class="line-content">  document.getElementById("totalResolved").innerText = fmtInt(totalResolved);</td></tr><tr><td class="line-number" value="499"></td><td class="line-content">  document.getElementById("pctResolved").innerText = `(${fmtPct(pct(totalResolved, totalSubmitted))})`;</td></tr><tr><td class="line-number" value="500"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="501"></td><td class="line-content">  // 2) fetch all chart data (parallel)</td></tr><tr><td class="line-number" value="502"></td><td class="line-content">  const [</td></tr><tr><td class="line-number" value="503"></td><td class="line-content">    state, district, issue,</td></tr><tr><td class="line-number" value="504"></td><td class="line-content">    signalMatrix, issueMatrix, statusMatrix,</td></tr><tr><td class="line-number" value="505"></td><td class="line-content">    reported</td></tr><tr><td class="line-number" value="506"></td><td class="line-content">  ] = await Promise.all([</td></tr><tr><td class="line-number" value="507"></td><td class="line-content">    fetch("/api/state").then(r=&gt;r.json()),</td></tr><tr><td class="line-number" value="508"></td><td class="line-content">    fetch("/api/district").then(r=&gt;r.json()),</td></tr><tr><td class="line-number" value="509"></td><td class="line-content">    fetch("/api/issue_type").then(r=&gt;r.json()),</td></tr><tr><td class="line-number" value="510"></td><td class="line-content">    fetch("/api/state_signal_strength_matrix").then(r=&gt;r.json()),</td></tr><tr><td class="line-number" value="511"></td><td class="line-content">    fetch("/api/state_issue_matrix").then(r=&gt;r.json()),</td></tr><tr><td class="line-number" value="512"></td><td class="line-content">    fetch("/api/state_status_matrix").then(r=&gt;r.json()),</td></tr><tr><td class="line-number" value="513"></td><td class="line-content">    fetch("/api/reported_months").then(r=&gt;r.json())</td></tr><tr><td class="line-number" value="514"></td><td class="line-content">  ]);</td></tr><tr><td class="line-number" value="515"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="516"></td><td class="line-content">  // Row 1 charts</td></tr><tr><td class="line-number" value="517"></td><td class="line-content">  new Chart(stateChart, {</td></tr><tr><td class="line-number" value="518"></td><td class="line-content">    type:"bar",</td></tr><tr><td class="line-number" value="519"></td><td class="line-content">    data:{ labels:Object.keys(state), datasets:[{ label:"Total Complaints by State", data:Object.values(state), backgroundColor:"#3b82f6" }] },</td></tr><tr><td class="line-number" value="520"></td><td class="line-content">    options: barOptions</td></tr><tr><td class="line-number" value="521"></td><td class="line-content">  });</td></tr><tr><td class="line-number" value="522"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="523"></td><td class="line-content">  new Chart(districtChart, {</td></tr><tr><td class="line-number" value="524"></td><td class="line-content">    type:"bar",</td></tr><tr><td class="line-number" value="525"></td><td class="line-content">    data:{ labels:Object.keys(district), datasets:[{ label:"Total Complaints by District", data:Object.values(district), backgroundColor:"#34d399" }] },</td></tr><tr><td class="line-number" value="526"></td><td class="line-content">    options: barOptions</td></tr><tr><td class="line-number" value="527"></td><td class="line-content">  });</td></tr><tr><td class="line-number" value="528"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="529"></td><td class="line-content">  new Chart(issueChart, {</td></tr><tr><td class="line-number" value="530"></td><td class="line-content">    type:"bar",</td></tr><tr><td class="line-number" value="531"></td><td class="line-content">    data:{ labels:Object.keys(issue), datasets:[{ label:"Total Complaints by Issue Type", data:Object.values(issue), backgroundColor:"#22c55e" }] },</td></tr><tr><td class="line-number" value="532"></td><td class="line-content">    options: barOptions</td></tr><tr><td class="line-number" value="533"></td><td class="line-content">  });</td></tr><tr><td class="line-number" value="534"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="535"></td><td class="line-content">  // Row 2 left: Signal Strength by State (stacked horizontal + numbers)</td></tr><tr><td class="line-number" value="536"></td><td class="line-content">  const signalOptions = {</td></tr><tr><td class="line-number" value="537"></td><td class="line-content">    responsive:true,</td></tr><tr><td class="line-number" value="538"></td><td class="line-content">    maintainAspectRatio:false,</td></tr><tr><td class="line-number" value="539"></td><td class="line-content">    indexAxis:"y",</td></tr><tr><td class="line-number" value="540"></td><td class="line-content">    plugins:{</td></tr><tr><td class="line-number" value="541"></td><td class="line-content">      legend:{ display:true, position:"top" },</td></tr><tr><td class="line-number" value="542"></td><td class="line-content">      datalabels:{</td></tr><tr><td class="line-number" value="543"></td><td class="line-content">        color:"#111827",</td></tr><tr><td class="line-number" value="544"></td><td class="line-content">        font:{ size:10, weight:"700" },</td></tr><tr><td class="line-number" value="545"></td><td class="line-content">        anchor:"center",</td></tr><tr><td class="line-number" value="546"></td><td class="line-content">        align:"center",</td></tr><tr><td class="line-number" value="547"></td><td class="line-content">        clamp:true,</td></tr><tr><td class="line-number" value="548"></td><td class="line-content">        formatter:(value)=&gt;{ const v=Number(value)||0; return v&gt;0 ? v : ""; }</td></tr><tr><td class="line-number" value="549"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="550"></td><td class="line-content">    },</td></tr><tr><td class="line-number" value="551"></td><td class="line-content">    scales:{</td></tr><tr><td class="line-number" value="552"></td><td class="line-content">      x:{ stacked:true, ticks:{ font:{ size:10 } } },</td></tr><tr><td class="line-number" value="553"></td><td class="line-content">      y:{ stacked:true, ticks:{ font:{ size:10 } } }</td></tr><tr><td class="line-number" value="554"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="555"></td><td class="line-content">  };</td></tr><tr><td class="line-number" value="556"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="557"></td><td class="line-content">  if (signalMatrix &amp;&amp; signalMatrix.error) {</td></tr><tr><td class="line-number" value="558"></td><td class="line-content">    new Chart(coverageChart, {</td></tr><tr><td class="line-number" value="559"></td><td class="line-content">      type:"bar",</td></tr><tr><td class="line-number" value="560"></td><td class="line-content">      data:{ labels:["No data"], datasets:[{ label:"Signal Strength", data:[0] }] },</td></tr><tr><td class="line-number" value="561"></td><td class="line-content">      options:{</td></tr><tr><td class="line-number" value="562"></td><td class="line-content">        ...signalOptions,</td></tr><tr><td class="line-number" value="563"></td><td class="line-content">        plugins:{</td></tr><tr><td class="line-number" value="564"></td><td class="line-content">          ...signalOptions.plugins,</td></tr><tr><td class="line-number" value="565"></td><td class="line-content">          datalabels:{ display:false },</td></tr><tr><td class="line-number" value="566"></td><td class="line-content">          legend:{ display:false },</td></tr><tr><td class="line-number" value="567"></td><td class="line-content">          title:{ display:true, text: signalMatrix.error, color:"#6b7280", font:{ size:12 } }</td></tr><tr><td class="line-number" value="568"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="569"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="570"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="571"></td><td class="line-content">  } else {</td></tr><tr><td class="line-number" value="572"></td><td class="line-content">    const sStates = signalMatrix.states || [];</td></tr><tr><td class="line-number" value="573"></td><td class="line-content">    const strengths = signalMatrix.signal_strengths || [];</td></tr><tr><td class="line-number" value="574"></td><td class="line-content">    const sMatrix = signalMatrix.matrix || {};</td></tr><tr><td class="line-number" value="575"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="576"></td><td class="line-content">    const SIGNAL_COLORS = [</td></tr><tr><td class="line-number" value="577"></td><td class="line-content">      "#8b5cf6","#06b6d4","#f97316","#22c55e",</td></tr><tr><td class="line-number" value="578"></td><td class="line-content">      "#a855f7","#0ea5e9","#f43f5e","#84cc16"</td></tr><tr><td class="line-number" value="579"></td><td class="line-content">    ];</td></tr><tr><td class="line-number" value="580"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="581"></td><td class="line-content">    const signalDatasets = strengths.map((ss, idx) =&gt; ({</td></tr><tr><td class="line-number" value="582"></td><td class="line-content">      label: ss,</td></tr><tr><td class="line-number" value="583"></td><td class="line-content">      data: sMatrix[ss] || [],</td></tr><tr><td class="line-number" value="584"></td><td class="line-content">      backgroundColor: SIGNAL_COLORS[idx % SIGNAL_COLORS.length],</td></tr><tr><td class="line-number" value="585"></td><td class="line-content">      borderColor: SIGNAL_COLORS[idx % SIGNAL_COLORS.length],</td></tr><tr><td class="line-number" value="586"></td><td class="line-content">      borderWidth: 1</td></tr><tr><td class="line-number" value="587"></td><td class="line-content">    }));</td></tr><tr><td class="line-number" value="588"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="589"></td><td class="line-content">    new Chart(coverageChart, {</td></tr><tr><td class="line-number" value="590"></td><td class="line-content">      type: "bar",</td></tr><tr><td class="line-number" value="591"></td><td class="line-content">      data: { labels: sStates, datasets: signalDatasets },</td></tr><tr><td class="line-number" value="592"></td><td class="line-content">      options: signalOptions</td></tr><tr><td class="line-number" value="593"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="594"></td><td class="line-content">  }</td></tr><tr><td class="line-number" value="595"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="596"></td><td class="line-content">  // Row 2 middle: Issue Type by State (stacked horizontal + numbers)</td></tr><tr><td class="line-number" value="597"></td><td class="line-content">  const iStates = issueMatrix.states || [];</td></tr><tr><td class="line-number" value="598"></td><td class="line-content">  const issueTypes = issueMatrix.issue_types || [];</td></tr><tr><td class="line-number" value="599"></td><td class="line-content">  const iMatrix = issueMatrix.matrix || {};</td></tr><tr><td class="line-number" value="600"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="601"></td><td class="line-content">  const issueByStateOptions = {</td></tr><tr><td class="line-number" value="602"></td><td class="line-content">    responsive:true,</td></tr><tr><td class="line-number" value="603"></td><td class="line-content">    maintainAspectRatio:false,</td></tr><tr><td class="line-number" value="604"></td><td class="line-content">    indexAxis:"y",</td></tr><tr><td class="line-number" value="605"></td><td class="line-content">    plugins:{</td></tr><tr><td class="line-number" value="606"></td><td class="line-content">      legend:{ display:true, position:"top" },</td></tr><tr><td class="line-number" value="607"></td><td class="line-content">      datalabels:{</td></tr><tr><td class="line-number" value="608"></td><td class="line-content">        color:"#111827",</td></tr><tr><td class="line-number" value="609"></td><td class="line-content">        font:{ size:10, weight:"700" },</td></tr><tr><td class="line-number" value="610"></td><td class="line-content">        anchor:"center",</td></tr><tr><td class="line-number" value="611"></td><td class="line-content">        align:"center",</td></tr><tr><td class="line-number" value="612"></td><td class="line-content">        clamp:true,</td></tr><tr><td class="line-number" value="613"></td><td class="line-content">        formatter:(value)=&gt;{ const v=Number(value)||0; return v&gt;0 ? v : ""; }</td></tr><tr><td class="line-number" value="614"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="615"></td><td class="line-content">    },</td></tr><tr><td class="line-number" value="616"></td><td class="line-content">    scales:{ x:{ stacked:true, ticks:{ font:{ size:10 } } }, y:{ stacked:true, ticks:{ font:{ size:10 } } } }</td></tr><tr><td class="line-number" value="617"></td><td class="line-content">  };</td></tr><tr><td class="line-number" value="618"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="619"></td><td class="line-content">  new Chart(issueByStateChart, {</td></tr><tr><td class="line-number" value="620"></td><td class="line-content">    type:"bar",</td></tr><tr><td class="line-number" value="621"></td><td class="line-content">    data:{ labels:iStates, datasets: issueTypes.map(it=&gt;({ label:it, data:iMatrix[it] || [] })) },</td></tr><tr><td class="line-number" value="622"></td><td class="line-content">    options: issueByStateOptions</td></tr><tr><td class="line-number" value="623"></td><td class="line-content">  });</td></tr><tr><td class="line-number" value="624"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="625"></td><td class="line-content">  // Row 2 right: Status Report by State (stacked horizontal + numbers)</td></tr><tr><td class="line-number" value="626"></td><td class="line-content">  const stStates = statusMatrix.states || [];</td></tr><tr><td class="line-number" value="627"></td><td class="line-content">  const statuses = statusMatrix.statuses || [];</td></tr><tr><td class="line-number" value="628"></td><td class="line-content">  const stMatrix = statusMatrix.matrix || {};</td></tr><tr><td class="line-number" value="629"></td><td class="line-content">  const statusColors = { "Submitted":"#3b82f6", "In Progress":"#f59e0b", "Resolved":"#16a34a" };</td></tr><tr><td class="line-number" value="630"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="631"></td><td class="line-content">  const statusOptions = {</td></tr><tr><td class="line-number" value="632"></td><td class="line-content">    responsive:true,</td></tr><tr><td class="line-number" value="633"></td><td class="line-content">    maintainAspectRatio:false,</td></tr><tr><td class="line-number" value="634"></td><td class="line-content">    indexAxis:"y",</td></tr><tr><td class="line-number" value="635"></td><td class="line-content">    plugins:{</td></tr><tr><td class="line-number" value="636"></td><td class="line-content">      legend:{ display:true, position:"top" },</td></tr><tr><td class="line-number" value="637"></td><td class="line-content">      datalabels:{</td></tr><tr><td class="line-number" value="638"></td><td class="line-content">        color:"#111827",</td></tr><tr><td class="line-number" value="639"></td><td class="line-content">        font:{ size:10, weight:"700" },</td></tr><tr><td class="line-number" value="640"></td><td class="line-content">        anchor:"center",</td></tr><tr><td class="line-number" value="641"></td><td class="line-content">        align:"center",</td></tr><tr><td class="line-number" value="642"></td><td class="line-content">        clamp:true,</td></tr><tr><td class="line-number" value="643"></td><td class="line-content">        formatter:(value)=&gt;{ const v=Number(value)||0; return v&gt;0 ? v : ""; }</td></tr><tr><td class="line-number" value="644"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="645"></td><td class="line-content">    },</td></tr><tr><td class="line-number" value="646"></td><td class="line-content">    scales:{ x:{ stacked:true, ticks:{ font:{ size:10 } } }, y:{ stacked:true, ticks:{ font:{ size:10 } } } }</td></tr><tr><td class="line-number" value="647"></td><td class="line-content">  };</td></tr><tr><td class="line-number" value="648"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="649"></td><td class="line-content">  new Chart(statusByStateChart, {</td></tr><tr><td class="line-number" value="650"></td><td class="line-content">    type:"bar",</td></tr><tr><td class="line-number" value="651"></td><td class="line-content">    data:{ labels:stStates, datasets: statuses.map(st=&gt;({ label:st, data:stMatrix[st] || [], backgroundColor: statusColors[st] || "#9ca3af" })) },</td></tr><tr><td class="line-number" value="652"></td><td class="line-content">    options: statusOptions</td></tr><tr><td class="line-number" value="653"></td><td class="line-content">  });</td></tr><tr><td class="line-number" value="654"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="655"></td><td class="line-content">  // Row 3: Complaints reported (total)</td></tr><tr><td class="line-number" value="656"></td><td class="line-content">  const monthOrder = ["January","February","March","April","May","June","July","August","September","October","November","December"];</td></tr><tr><td class="line-number" value="657"></td><td class="line-content">  const counts = monthOrder.map(m =&gt; reported[m] ?? 0);</td></tr><tr><td class="line-number" value="658"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="659"></td><td class="line-content">  new Chart(reportedMonthsChart, {</td></tr><tr><td class="line-number" value="660"></td><td class="line-content">    type:"line",</td></tr><tr><td class="line-number" value="661"></td><td class="line-content">    data:{ labels:monthOrder, datasets:[{ label:"Total Complaints by Month", data:counts, tension:0.25 }] },</td></tr><tr><td class="line-number" value="662"></td><td class="line-content">    options: {</td></tr><tr><td class="line-number" value="663"></td><td class="line-content">      responsive: true,</td></tr><tr><td class="line-number" value="664"></td><td class="line-content">      maintainAspectRatio: false,</td></tr><tr><td class="line-number" value="665"></td><td class="line-content">      plugins: {</td></tr><tr><td class="line-number" value="666"></td><td class="line-content">        legend: { display: false },</td></tr><tr><td class="line-number" value="667"></td><td class="line-content">        datalabels: {</td></tr><tr><td class="line-number" value="668"></td><td class="line-content">          display: true,</td></tr><tr><td class="line-number" value="669"></td><td class="line-content">          color: "#374151",</td></tr><tr><td class="line-number" value="670"></td><td class="line-content">          font: { size: 10, weight: "700" },</td></tr><tr><td class="line-number" value="671"></td><td class="line-content">          anchor: "end",</td></tr><tr><td class="line-number" value="672"></td><td class="line-content">          align: "top",</td></tr><tr><td class="line-number" value="673"></td><td class="line-content">          offset: 4,</td></tr><tr><td class="line-number" value="674"></td><td class="line-content">          clamp: true,</td></tr><tr><td class="line-number" value="675"></td><td class="line-content">          formatter: (value) =&gt; {</td></tr><tr><td class="line-number" value="676"></td><td class="line-content">            const v = Number(value) || 0;</td></tr><tr><td class="line-number" value="677"></td><td class="line-content">            return v &gt; 0 ? v : "";</td></tr><tr><td class="line-number" value="678"></td><td class="line-content">          }</td></tr><tr><td class="line-number" value="679"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="680"></td><td class="line-content">      },</td></tr><tr><td class="line-number" value="681"></td><td class="line-content">      scales: {</td></tr><tr><td class="line-number" value="682"></td><td class="line-content">        x: { ticks: { font: { size: 10 } } },</td></tr><tr><td class="line-number" value="683"></td><td class="line-content">        y: { ticks: { font: { size: 10 } } }</td></tr><tr><td class="line-number" value="684"></td><td class="line-content">      }</td></tr><tr><td class="line-number" value="685"></td><td class="line-content">    }</td></tr><tr><td class="line-number" value="686"></td><td class="line-content">  });</td></tr><tr><td class="line-number" value="687"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="688"></td><td class="line-content">  // MAP: District heatmap using /api/district + district geojson</td></tr><tr><td class="line-number" value="689"></td><td class="line-content">  initDistrictMap(district);</td></tr><tr><td class="line-number" value="690"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="691"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="692"></td><td class="line-content">loadDashboard();</td></tr><tr><td class="line-number" value="693"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="694"></td><td class="line-content"><span class="html-tag">&lt;/body&gt;</span></td></tr><tr><td class="line-number" value="695"></td><td class="line-content"><span class="html-tag">&lt;/html&gt;</span><span class="html-end-of-file"></span></td></tr></tbody></table></body></html>